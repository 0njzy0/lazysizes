#lazysizes RIaS extension (Responsive image as a service / Responsive image on demand) 

The RiaS plugin enables lazySizes to hook into any third party (ReSrc, Pixtulate, mobify, WURFL's Image Tailor ...) or self hosted restful responsive image service (responsive image on demand).

In general the RIaS  plugin combines the simplicity of the famous Imager.js solution with the future power of native responsive images implementations.

The rias plugin also allows art direction by combining rias with a ``picture`` element.

##Basic/quick usage

* Simply add the rias plugin right after the lazysizes scripts or concat those scripts into your script bundle:

```html
<!-- polyfill respimg -->
<script src="respimage.js"></script>

<!-- include lazysizes + rias extension -->
<script src="../lazysizes.js"></script>
<script src="../plugins/rias/ls.rias.js"></script>
```


* Add the ``lazyload`` class and the ``data-sizes="auto"`` attribute to your image and include the placeholder ``{width}`` at the point, where your image service expects the requested width of the image.

```html
<img
	data-src="http://placehold.it/{width}"
	data-sizes="auto"
	class="lazyload"
	alt="" />
```

##[Demo](http://afarkas.github.io/lazysizes/rias/)
A [demo with markup and code examples can be seen here](http://afarkas.github.io/lazysizes/rias/).

##Configuration/Options

The rias plugin can be configured through the ``lazySizesConfig.rias`` option object, which should be configured before the lazysizes script.

```js
window.lazySizesConfig = window.lazySizesConfig || {};
window.lazySizesConfig.rias = window.lazySizesConfig.rias || {};

window.lazySizesConfig.rias.widths = [320, 480, 640, 960];
window.lazySizesConfig.rias.encodeSrc = true;
```

or element specifc with a corresponding ``data-*`` attribute:

```html
<img
    data-widths="[160, 320]"
    data-encodesrc="false"
    data-src="http://placehold.it/{width}"
    data-sizes="auto"
    class="lazyload"
    alt="" />
```

All rias options can also be used as ``data-*`` attributes.

###URL generation and {placeholder}s

The url is dynamically generated by replacing placeholder values, which are enclosed by curly brackets.

Most useful placeholders are:

* ``{width}`` represents the width of the image
* ``{quality}`` represents the quality (mostly for JPEG compression)

```html
<img
    data-quality="80"
    src="http://placehold.it/100x50"
    data-src="http://placehold.it/{width}?quality={quality}"
    data-sizes="auto"
    class="lazyload"
    alt="" />
```

All rias options, which represent primitive data types (i.e.: string, numbers or boolean) can also be used as a {placeholder} inside the url.

###List of Options

* ``lazySizesConfig.rias.srcAttr`` (default: ``"data-src"``): The attribute, which should be transformed to ``srcset``. (The extension will also automatically check the ``lazySizesConfig.srcsetAttr`` and ``lazySizesConfig.srcAttr``)
* ``lazySizesConfig.rias.widths`` (``array of numbers``): The widths option reduces the calculated ``width`` to the allowed widths. The numeric width can also be simply mapped to a string (i.e.: small, medium, large) using the ``widthmap`` option. The default value is the following array: ``[96, 160, 320, 480, 640, 800, 960, 1280, 1600, 1920, 2240, 2560, 2880]``.
* ``lazySizesConfig.rias.widthmap`` (``{}``): The widthmap option allows you to simply transform a numeric width to a string.
    ```js
    window.lazySizesConfig = window.lazySizesConfig || {};
    window.lazySizesConfig.rias = window.lazySizesConfig.rias || {};

    window.lazySizesConfig.rias.widths = [320, 640, 940];
    window.lazySizesConfig.rias.widthmap = {
        320: 'small',
        640: 'medium',
        940: 'large'
   };
    ```
* ``lazySizesConfig.rias.quality`` (default: 78): The default quality value for replacing the {quality} placeholder.
* ``lazySizesConfig.rias.hdQuality`` (default: 60): On higher resolutions it is often possible to use heavier compressed images without reducing the perceived image quality. If a retina device is used the {quality} placeholder  is replaced by the ``hdQuality`` option instead of the normal ``quality`` option.
* ``lazySizesConfig.rias.absUrl`` (default: ``false``): Wether the value of the ``data-src``/``srcsetAttr`` attribute should be resolved to an absolute url.
* ``lazySizesConfig.rias.encodeSrc`` (default: ``false``): Wether the value of the ``data-src``/``srcsetAttr`` should be encoded using ``encodeURIComponent``.
* ``lazySizesConfig.rias.modifyOptions`` (default: ``function`` noop ): A ``function`` that gets an data object passed with the options as the ``details`` and the corresponding ``img`` element as the ``target``. Can be used to modify existing options/placeholder values or to add new placeholder values. An event with the name ``lazyriasmodifyoptions`` is also fired at the element.
* ``lazySizesConfig.rias.modifySrc`` (default: ``function`` noop ): A function that gets passed the generated src, the ``img``/``source`` element and the option object. The function can modify/change the generated src and return it.
* ``lazySizesConfig.rias.prefix`` (default: ``""``): A string, which is prepended to the generated src.
```html
<script>
window.lazySizesConfig = window.lazySizesConfig || {};
window.lazySizesConfig.rias = {
    prefix: 'http://placehold.it/'
};
</script>
<img
    src="http://placehold.it/100"
    data-src="{width}"
    data-sizes="auto"
    class="lazyload"
    alt="" />
```
* ``lazySizesConfig.rias.postfix`` (default: ``""`` ): A string, which is appended to the generated src.

With lazysizes + rias extension you have a script to rule them all. You won't need to include a script provided by a third party image on demand service.

##Advanced Examples

###Embedding via CDN and combohandler

In case you want to use a CDN you can use jsDelivr's combohandler service:

```html
<script src="http://cdn.jsdelivr.net/g/respimage(respimage.min.js),lazysizes(lazysizes.min.js+plugins/rias/ls.rias.min.js)" async=""></script>
```

###Conditional loading of the respimage polyfill

In case you don't want to include a full polyfill for all browsers you write the following:

```html
<!-- polyfill responsive images: https://github.com/aFarkas/respimage -->
<script>
    function loadJS(u){var r=document.getElementsByTagName("script")[0],s=document.createElement("script");s.src=u;r.parentNode.insertBefore(s,r);}

    if(!window.HTMLPictureElement){
        document.createElement('picture');
        loadJS("http://cdn.jsdelivr.net/g/respimage(respimage.min.js)");
    }
</script>

<!--  your stylesheets -->

<script src="http://cdn.jsdelivr.net/g/lazysizes(lazysizes.min.js+plugins/rias/ls.rias.min.js)" async=""></script>
```

###Tip: Constraining the pixel density for a generated ``srcset`` attribute.

In case you want to constrain the pixel density for the generated ``srcset`` list you can combine the RiAS plugin with [the optimumx extension](../optimumx).

###Overriding existing placeholders or Extending new placeholders

The RIaS plugin is highly flexible in extending possible {{placeholder}} values. Each {{placeholder}} will be tried to be replaced by searching it in the ``lazySizesConfig.rias`` option object or by searching for a corresponding ``data-*`` attribute.

Additionally the ``modifyOptions`` callback or the equivalent ``lazyriasmodifyoptions`` event can be used to generate new or modify existing placeholders:

**Using ``data-*`` to override an existing placeholder:**

```html
<img
    data-widths="[160, 320]"
    data-src="http://placehold.it/{width}"
    data-sizes="auto"
    class="lazyload" />
```

**Using ``data-*`` to define a new placeholder:**

```html
<img
    data-custom="foo"
    data-src="http://placehold.it/{width}/{custom}"
    data-sizes="auto"
    class="lazyload" />
```

**Using the ``lazySizesConfig.rias`` object to define a new placeholder:**

```html
<script>
window.lazySizesConfig = window.lazySizesConfig || {};
window.lazySizesConfig.rias = {
    custom: 'test',
    dynCustom: function(elem, opts){
        return 'computed-something';
    }
};
</script>
<img
    data-src="http://placehold.it/{width}/{custom}/{dynCustom}"
    data-sizes="auto"
    class="lazyload"
    alt="" />
```

**Using the ``lazyriasmodifyoptions`` event to define or change a placeholder object:**

```html
<script>
document.addEventListener('lazyriasmodifyoptions', function(e){
    // change available widths and widthmap for .special-widths elements
    if($(e.target).is('.special-widths')){
        e.details.widths = [320, 480, 600];
        e.details.widthmap = {
              320: 'small',
              480: 'medium',
              600: 'large'
         };
    }

    //add new custom property with value 'foo'
    e.details.custom = 'foo';
});
</script>
<img
    data-src="http://placehold.it/{width}/{custom}/"
    data-sizes="auto"
    class="lazyload special-widths"
    alt="" />
```

